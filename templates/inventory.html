{% extends "base.html" %}

{% block content %}
<div class="inventory-container">
    <h2>Your Marine Creature Collection</h2>

<form method="GET" id="filterForm" class="filter-form">
    <select name="filter" onchange="document.getElementById('filterForm').submit()">
        <option value="all" {% if selected_filter == "all" %}selected{% endif %}>All</option>
        <option value="common" {% if selected_filter == "common" %}selected{% endif %}>Common</option>
        <option value="rare" {% if selected_filter == "rare" %}selected{% endif %}>Rare</option>
        <option value="epic" {% if selected_filter == "epic" %}selected{% endif %}>Epic</option>
        <option value="legendary" {% if selected_filter == "legendary" %}selected{% endif %}>Legendary</option>
    </select>
</form>

    <div class="inventory-stats">
        <div class="stat-item">
            <h3>Total Creatures</h3>
            <span class="stat-number">{{ inventory|length }}</span>
        </div>
        <div class="stat-item">
            <h3>Common</h3>
            <span class="stat-number">
                {% set common_count = inventory|selectattr('rarity', 'equalto', 'common')|list|length %}
                {{ common_count }}
            </span>
        </div>
        <div class="stat-item">
            <h3>Rare</h3>
            <span class="stat-number">
                {% set rare_count = inventory|selectattr('rarity', 'equalto', 'rare')|list|length %}
                {{ rare_count }}
            </span>
        </div>
        <div class="stat-item">
            <h3>Epic</h3>
            <span class="stat-number">
                {% set epic_count = inventory|selectattr('rarity', 'equalto', 'epic')|list|length %}
                {{ epic_count }}
            </span>
        </div>
        <div class="stat-item">
            <h3>Legendary</h3>
            <span class="stat-number">
                {% set legendary_count = inventory|selectattr('rarity', 'equalto', 'legendary')|list|length %}
                {{ legendary_count }}
            </span>
        </div>
    </div>

    {% if inventory %}
    <div class="inventory-grid">

    {% for creature in inventory %}
    <div class="inventory-container">
    <div class="creature-card {{ creature.rarity }}">
        <div class="creature-image">
            <img src="{{ url_for('static', filename=creature.image) }}" 
            alt="{{ creature.name }}"
            class="inventory-image toggle-desc">
        </div>
        <h4 class="creature-name">{{ creature.name }}</h4>
        <p class="rarity {{ creature.rarity }}">{{ creature.rarity|title }}</p>
        <div class="creature-description hidden">
             {{ creature.description }}
        </div>
    </div>
    </div>
    {% endfor %}
    </div> 
    {% else %}
    <div class="no-creatures">
        <div class="empty-state">
            <div class="empty-icon">ðŸŒŠ</div>
            <h3>No creatures yet!</h3>
            <p>Go to the Gacha section to pull your first marine creature.</p>
            <a href="{{ url_for('gacha') }}" class="ocean-button">Go to Gacha</a>
        </div>
    </div>
    {% endif %}
</div>

<div id="descriptionPopup" class="popup">
        <div class="popup-content">
            <span id="popupClose" class="popup-close">&times;</span>
            <h2 id="popupName"></h2>
            <p id="popupRarity"></p>
            <p id="popupDescription"></p>
        </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/inventory.js') }}"></script>
{% endblock %}